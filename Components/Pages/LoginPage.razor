@rendermode @(new InteractiveServerRenderMode(false))
@page "/"
@layout Iskolaryo.Components.Layout.LoginLayout

@using Iskolaryo.Auth
@using Microsoft.AspNetCore.Components.Authorization

@inject AuthenticationStateProvider AuthenticationStateProvider
@inject UserAccountService UserAccountService
@inject NavigationManager NavigationManager

<div class="login-card">
    <input @bind-value="Username" type="text" placeholder="Username" />"
    <input @bind-value="Password" type="text" placeholder="Password" />"
<button @onclick="Login">Login</button>

</div>


@code {
    public string Username { get; set; }
    public string Password { get; set; }

    public async Task Login()
    {
        var user = UserAccountService.GetUserAccount(Username);
        if (user == null || user.Password != Password)
        {
            Console.WriteLine("Invalid username or password");
            return;
        }

        var customAuthStateProvider = (CustomAuthStateProvider)AuthenticationStateProvider;
        await customAuthStateProvider.UpdateAuthenticationState(new UserSession
            {
                Username = Username,
                Role = user.Role
            });
        NavigationManager.NavigateTo("/home", true);
    }
}
